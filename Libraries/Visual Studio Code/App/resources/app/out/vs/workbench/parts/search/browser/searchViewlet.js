/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
define("vs/css!vs/workbench/parts/search/browser/media/searchviewlet",["vs/css!vs/workbench/parts/search/browser/searchViewlet"],{});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=3>s?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(3>s?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},__param=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}};define("vs/workbench/parts/search/common/searchModel",["require","exports","vs/base/common/async","vs/base/common/strings","vs/base/common/paths","vs/base/common/lifecycle","vs/base/common/collections","vs/base/common/eventEmitter","vs/editor/common/editorCommon","vs/editor/common/core/range","vs/editor/common/services/modelService"],function(e,t,n,i,o,s,r,a,c,l,u){"use strict";var h=function(){function e(e,t,n,i,o){this._parent=e,this._lineText=t,this._id=e.id()+">"+n+">"+i,this._range=new l.Range(1+n,1+i,1+n,1+i+o)}return e.prototype.id=function(){return this._id},e.prototype.parent=function(){return this._parent},e.prototype.text=function(){return this._lineText},e.prototype.range=function(){return this._range},e.prototype.preview=function(){var e=this._lineText.substring(0,this._range.startColumn-1),t=this._lineText.substring(this._range.startColumn-1,this._range.endColumn-1),n=this._lineText.substring(this._range.endColumn-1,Math.min(this._range.endColumn+150,this._lineText.length));return e=i.lcut(e,26),{before:e,inside:t,after:n}},e}();t.Match=h;var p=function(e){function t(t){e.call(this,t,null,Date.now(),Date.now(),Date.now())}return __extends(t,e),t}(h);t.EmptyMatch=p;var d=function(){function e(e,t){this._resource=t,this._parent=e,this._matches=Object.create(null)}return e.prototype.dispose=function(){},e.prototype.id=function(){return this.resource().toString()},e.prototype.parent=function(){return this._parent},e.prototype.add=function(e){this._matches[e.id()]=e},e.prototype.remove=function(e){delete this._matches[e.id()]},e.prototype.matches=function(){return r.values(this._matches)},e.prototype.count=function(){var e=0;for(var t in this._matches)this._matches[t]instanceof p||(e+=1);return e},e.prototype.resource=function(){return this._resource},e.prototype.name=function(){return o.basename(this.resource().fsPath)},e}();t.FileMatch=d;var f=function(e){function t(t,i,o,s,r){var a=this;e.call(this,t,i),this._modelDecorations=[],this._unbind=[],this._query=o,this._model=s,this._diskFileMatch=r,this._updateScheduler=new n.RunOnceScheduler(this._updateMatches.bind(this),250),this._unbind.push(this._model.addListener(c.EventType.ModelContentChanged,function(e){return a._updateScheduler.schedule()})),this._updateMatches()}return __extends(t,e),t.prototype.dispose=function(){this._unbind=s.cAll(this._unbind),this._isTextModelDisposed()||this._model.deltaDecorations(this._modelDecorations,[])},t.prototype._updateMatches=function(){var e=this;if(!this._isTextModelDisposed()){this._matches=Object.create(null);var t=this._model.findMatches(this._query.pattern,this._model.getFullModelRange(),this._query.isRegExp,this._query.isCaseSensitive,this._query.isWordMatch);0===t.length?this.add(new p(this)):t.forEach(function(t){return e.add(new h(e,e._model.getLineContent(t.startLineNumber),t.startLineNumber-1,t.startColumn-1,t.endColumn-t.startColumn))}),this.parent().emit("changed",this),this.updateHighlights()}},t.prototype.updateHighlights=function(){this._model.isDisposed()||(this.parent()._showHighlights?this._modelDecorations=this._model.deltaDecorations(this._modelDecorations,this.matches().filter(function(e){return!(e instanceof p)}).map(function(e){return{range:e.range(),options:t.DecorationOption}})):this._modelDecorations=this._model.deltaDecorations(this._modelDecorations,[]))},t.prototype._isTextModelDisposed=function(){return!this._model||this._model.isDisposed()},t.DecorationOption={stickiness:c.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,className:"findMatch",overviewRuler:{color:"rgba(246, 185, 77, 0.7)",darkColor:"rgba(246, 185, 77, 0.7)",position:c.OverviewRulerLane.Center}},t}(d);t.LiveFileMatch=f;var v=function(e){function t(t,n){e.call(this),this._disposables=[],this._matches=Object.create(null),this._modelService=n,this._query=t,this._query&&(this._modelService.onModelAdded(this._onModelAdded,this,this._disposables),this._modelService.onModelRemoved(this._onModelRemoved,this,this._disposables))}return __extends(t,e),t.prototype._onModelAdded=function(e){var t=e.getAssociatedResource(),n=this._matches[t.toString()];if(n){var i=new f(this,t,this._query,e,n);i.updateHighlights(),this._matches[t.toString()]=i,this.emit("changed",this)}},t.prototype._onModelRemoved=function(e){var t=this,n=e.getAssociatedResource(),i=this._matches[n.toString()];i instanceof f&&this.deferredEmit(function(){t.remove(i),t._matches[n.toString()]=i._diskFileMatch})},t.prototype.append=function(e){var t=this;e.forEach(function(e){var n=t._getOrAdd(e);n instanceof f&&(n=n._diskFileMatch),e.lineMatches.forEach(function(e){e.offsetAndLengths.forEach(function(t){var i=new h(n,e.preview,e.lineNumber,t[0],t[1]);n.add(i)})})})},t.prototype._getOrAdd=function(e){var t=this;return r.lookupOrInsert(this._matches,e.resource.toString(),function(){var n=t._modelService.getModel(e.resource),i=new d(t,e.resource);return n&&t._query&&(i=new f(t,e.resource,t._query,n,i)),i})},t.prototype.remove=function(e){delete this._matches[e.resource().toString()],e.dispose(),this.emit("changed",this)},t.prototype.matches=function(){return r.values(this._matches)},t.prototype.isEmpty=function(){return 0===this.fileCount()},t.prototype.fileCount=function(){return Object.keys(this._matches).length},t.prototype.count=function(){return this.matches().reduce(function(e,t){return e+t.count()},0)},t.prototype.toggleHighlights=function(e){if(this._showHighlights!==e){this._showHighlights=e;for(var t in this._matches){var n=this._matches[t];n instanceof f&&n.updateHighlights()}}},t.prototype.dispose=function(){this._disposables=s.dispose(this._disposables),s.dispose(this.matches()),e.prototype.dispose.call(this)},t=__decorate([__param(1,u.IModelService)],t)}(a.EventEmitter);t.SearchResult=v});var __decorate=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=3>s?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(3>s?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},__param=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}};define("vs/workbench/parts/search/common/searchQuery",["require","exports","vs/base/common/objects","vs/platform/search/common/search","vs/platform/configuration/common/configuration"],function(e,t,n,i,o){"use strict";function s(e){var t=e&&e.files&&e.files.exclude,i=e&&e.search&&e.search.exclude;if(!t&&!i)return null;if(!t||!i)return t||i;var o=Object.create(null);return o=n.mixin(o,t),o=n.mixin(o,i,!0)}t.getExcludes=s;var r=function(){function e(e){this.configurationService=e}return e.prototype.text=function(e,t){return this.query(i.QueryType.Text,e,t)},e.prototype.file=function(e){return this.query(i.QueryType.File,null,e)},e.prototype.query=function(e,t,i){void 0===i&&(i={});var o=this.configurationService.getConfiguration(),r=s(o);return i.excludePattern?n.mixin(i.excludePattern,r,!1):i.excludePattern=r,{type:e,folderResources:i.folderResources,extraFileResources:i.extraFileResources,filePattern:i.filePattern,excludePattern:i.excludePattern,includePattern:i.includePattern,maxResults:i.maxResults,fileEncoding:i.fileEncoding,contentPattern:t}},e=__decorate([__param(0,o.IConfigurationService)],e)}();t.QueryBuilder=r});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=3>s?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(3>s?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},__param=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}};define("vs/workbench/parts/search/browser/searchViewlet",["require","exports","vs/base/common/winjs.base","vs/nls!vs/workbench/parts/search/browser/searchViewlet","vs/editor/common/editorCommon","vs/base/common/lifecycle","vs/base/common/errors","vs/base/browser/ui/aria/aria","vs/base/common/glob","vs/base/common/types","vs/base/common/strings","vs/base/common/paths","vs/base/browser/dom","vs/base/common/actions","vs/base/browser/keyboardEvent","vs/base/common/timer","vs/base/browser/builder","vs/base/browser/ui/filelabel/fileLabel","vs/base/browser/ui/findinput/findInput","vs/base/browser/ui/leftRightWidget/leftRightWidget","vs/base/browser/ui/countBadge/countBadge","vs/base/parts/tree/browser/treeImpl","vs/base/parts/tree/browser/treeDefaults","vs/base/parts/tree/browser/actionsRenderer","vs/workbench/browser/actionBarRegistry","vs/workbench/common/memento","vs/workbench/browser/actions/openSettings","vs/workbench/common/events","vs/workbench/parts/files/common/files","vs/platform/files/common/files","vs/workbench/browser/viewlet","vs/workbench/parts/search/common/searchModel","vs/workbench/parts/search/common/searchQuery","vs/base/browser/ui/checkbox/checkbox","vs/workbench/parts/search/browser/search.contribution","vs/base/browser/ui/inputbox/inputBox","vs/workbench/services/editor/common/editorService","vs/workbench/services/viewlet/common/viewletService","vs/editor/common/core/range","vs/platform/storage/common/storage","vs/platform/configuration/common/configuration","vs/platform/contextview/browser/contextView","vs/platform/event/common/event","vs/platform/instantiation/common/instantiation","vs/platform/message/common/message","vs/platform/search/common/search","vs/platform/progress/common/progress","vs/platform/workspace/common/workspace","vs/platform/keybinding/common/keybindingService","vs/platform/telemetry/common/telemetry","vs/base/common/keyCodes","vs/css!./media/searchviewlet"],function(e,t,n,i,o,s,r,a,c,l,u,h,p,d,f,v,m,g,y,b,w,_,S,x,E,C,I,P,R,M,T,A,O,F,k,q,D,L,N,z,G,W,H,V,B,K,U,j,Q,$,Y){"use strict";var X=k.VIEWLET_ID,J=function(e){function t(t,n){e.call(this,"workbench.search.action.findInFolder",i.localize(0,null)),this.viewletService=n,this.resource=t}return __extends(t,e),t.prototype.run=function(e){var t=this;return this.viewletService.openViewlet(X,!0).then(function(e){e.searchInFolder(t.resource)})},t=__decorate([__param(1,L.IViewletService)],t)}(d.Action);t.FindInFolderAction=J;var Z=function(){function e(){}return e.prototype.getId=function(e,t){return t instanceof A.FileMatch?t.id():t instanceof A.Match?t.id():"root"},e.prototype.getChildren=function(e,t){var i=[];return t instanceof A.FileMatch?i=t.matches():t instanceof A.SearchResult&&(i=t.matches()),n.TPromise.as(i)},e.prototype.hasChildren=function(e,t){return t instanceof A.FileMatch||t instanceof A.SearchResult},e.prototype.getParent=function(e,t){var i=null;return t instanceof A.Match?i=t.parent():t instanceof A.FileMatch&&(i=t.parent()),n.TPromise.as(i)},e}();t.SearchDataSource=Z;var ee=function(){function e(){}return e.prototype.compare=function(e,t,n){return t instanceof A.FileMatch&&n instanceof A.FileMatch?u.localeCompare(t.resource().fsPath,n.resource().fsPath)||u.localeCompare(t.name(),n.name()):t instanceof A.Match&&n instanceof A.Match?N.Range.compareRangesUsingStarts(t.range(),n.range()):void 0},e}();t.SearchSorter=ee;var te=function(){function e(e){this.contextService=e}return e.prototype.getAriaLabel=function(e,t){if(t instanceof A.FileMatch){var n=this.contextService.toWorkspaceRelativePath(t.resource())||t.resource().fsPath;return i.localize(1,null,t.count(),t.name(),h.dirname(n))}return t instanceof A.Match?i.localize(2,null,t.text()):void 0},e=__decorate([__param(0,j.IWorkspaceContextService)],e)}();t.SearchAccessibilityProvider=te;var ne=function(e){function t(t){var n=this;e.call(this,{clickBehavior:S.ClickBehavior.ON_MOUSE_DOWN}),this.viewlet=t,this.downKeyBindingDispatcher.set(Y.CommonKeybindings.DELETE,function(e,t){n.onDelete(e,t)}),this.downKeyBindingDispatcher.set(Y.CommonKeybindings.ESCAPE,function(e,t){n.onEscape(e,t)})}return __extends(t,e),t.prototype.onEscape=function(t,n){return this.viewlet.cancelSearch()?!0:e.prototype.onEscape.call(this,t,n)},t.prototype.onDelete=function(e,t){for(var n=!1,i=e.getSelection(),o=0;o<i.length;o++){var s=i[o];s instanceof A.FileMatch&&(new se(e,s).run().done(null,r.onUnexpectedError),n=!0)}return n},t}(S.DefaultController),ie=function(){function e(){}return e.prototype.isVisible=function(e,t){return!(t instanceof A.FileMatch)||t.matches().length>0},e}(),oe=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.hasActions=function(t,n){return n instanceof A.FileMatch||e.prototype.hasActions.call(this,t,n)},t.prototype.getActions=function(t,n){return e.prototype.getActions.call(this,t,n).then(function(e){return n instanceof A.FileMatch&&e.unshift(new se(t,n)),e})},t}(E.ContributableActionProvider),se=function(e){function t(t,n){e.call(this,"remove",i.localize(3,null),"action-remove"),this.viewer=t,this.fileMatch=n}return __extends(t,e),t.prototype.run=function(){var e=this.fileMatch.parent();return e.remove(this.fileMatch),this.viewer.refresh(e)},t}(d.Action),re=function(e){function t(t,n){e.call(this,{actionProvider:new oe,actionRunner:t}),this.contextService=n}return __extends(t,e),t.prototype.getContentHeight=function(e,t){return 22},t.prototype.renderContents=function(e,t,n,o){var s=this;if(t instanceof A.FileMatch){var r=t,a=m.$(".filematch"),c=void 0,l=void 0,h=void 0;return c=function(e){return new g.FileLabel(e,r.resource(),s.contextService),null},l=function(e){var t=r.count();return new w.CountBadge(e,t,t>1?i.localize(4,null,t):i.localize(5,null,t))},h=new b.LeftRightWidget(a,c,l),a.appendTo(n),h.dispose.bind(h)}if(t instanceof A.EmptyMatch)p.addClass(n,"linematch"),m.$("a.plain.label").innerHtml(i.localize(6,null)).appendTo(n);else if(t instanceof A.Match){p.addClass(n,"linematch");var d=[],f=t.preview();d.push("<span>"),d.push(u.escape(f.before)),d.push('</span><span class="findInFileMatch">'),d.push(u.escape(f.inside)),d.push("</span><span>"),d.push(u.escape(f.after)),d.push("</span>"),m.$("a.plain").innerHtml(d.join(u.empty)).appendTo(n)}return null},t=__decorate([__param(1,j.IWorkspaceContextService)],t)}(x.ActionsRenderer),ae=function(e){function t(t){e.call(this,"refresh"),this.label=i.localize(7,null),this.enabled=!1,this["class"]="search-action refresh",this.viewlet=t}return __extends(t,e),t.prototype.run=function(){return this.viewlet.onQueryChanged(!0),n.TPromise.as(null)},t}(d.Action);t.RefreshAction=ae;var ce=function(e){function t(t){e.call(this,"selectOrRemove"),this.label=i.localize(8,null),this.enabled=!1,this.selectMode=!0,this.viewlet=t}return __extends(t,e),t.prototype.run=function(){var e;return e=this.selectMode?this.runAsSelect():this.runAsRemove(),this.selectMode=!this.selectMode,this.label=this.selectMode?i.localize(9,null):i.localize(10,null),e},t.prototype.runAsSelect=function(){return this.viewlet.getResults().addClass("select"),n.TPromise.as(null)},t.prototype.runAsRemove=function(){var e=[],t=this.viewlet.getControl();return t.getInput().matches().forEach(function(t){t.matches().filter(function(e){return e.$checked}).forEach(function(t){t.parent().remove(t),e.push(t.parent())})}),this.viewlet.getResults().removeClass("select"),e.length>0?t.refreshAll(e).then(function(){return t.refresh()}):n.TPromise.as(null)},t}(d.Action);t.SelectOrRemoveAction=ce;var le=function(e){function t(t){e.call(this,"collapseAll"),this.label=i.localize(11,null),this.enabled=!1,this["class"]="search-action collapse",this.viewlet=t}return __extends(t,e),t.prototype.run=function(){var e=this.viewlet.getControl();return e&&(e.collapseAll(),e.clearSelection(),e.clearFocus(),e.DOMFocus(),e.focusFirst()),n.TPromise.as(null)},t}(d.Action);t.CollapseAllAction=le;var ue=function(e){function t(t){e.call(this,"clearSearchResults"),this.label=i.localize(12,null),this.enabled=!1,this["class"]="search-action clear-search-results",this.viewlet=t}return __extends(t,e),t.prototype.run=function(){return this.viewlet.clearSearchResults(),n.TPromise.as(null)},t}(d.Action);t.ClearSearchResultsAction=ue;var he=function(e){function t(t){e.call(this,"configureGlobalExclusionsAction"),this.instantiationService=t,this.label=i.localize(13,null),this.enabled=!0,this["class"]="search-configure-exclusions"}return __extends(t,e),t.prototype.run=function(){var e=this.instantiationService.createInstance(I.OpenGlobalSettingsAction,I.OpenGlobalSettingsAction.ID,I.OpenGlobalSettingsAction.LABEL);return e.run().done(function(){return e.dispose()},r.onUnexpectedError),n.TPromise.as(null)},t=__decorate([__param(0,V.IInstantiationService)],t)}(d.Action),pe=function(){function e(e,t,n){void 0===n&&(n=Object.create(null)),this.contextViewProvider=t,this.onOptionChange=null,this.width=n.width||100,this.placeholder=n.placeholder||"",this.ariaLabel=n.ariaLabel||i.localize(14,null),this.listenersToRemove=[],this.pattern=null,this.domNode=null,this.inputNode=null,this.inputBox=null,this.buildDomNode(),Boolean(e)&&e.appendChild(this.domNode)}return e.prototype.destroy=function(){this.pattern.dispose(),this.listenersToRemove.forEach(function(e){e()}),this.listenersToRemove=[]},e.prototype.on=function(t,n){switch(t){case"keydown":case"keyup":m.$(this.inputBox.inputElement).on(t,n);break;case e.OPTION_CHANGE:this.onOptionChange=n}return this},e.prototype.setWidth=function(e){this.width=e,this.domNode.style.width=this.width+"px",this.contextViewProvider.layout(),this.setInputWidth()},e.prototype.getValue=function(){return this.inputBox.value},e.prototype.setValue=function(e){this.inputBox.value!==e&&(this.inputBox.value=e)},e.prototype.getGlob=function(){var e=this.getValue(),t=this.isGlobPattern();if(e){var n,i=Object.create(null);return n=t?c.splitGlobAware(e,",").map(function(e){return e.trim()}).filter(function(e){return!!e.length}):e.split(",").map(function(e){return u.trim(e.trim(),"/")}).filter(function(e){return!!e.length}).map(function(e){return"."===e[0]&&(e="*"+e),u.format("{{0}/**,**/{1}}",e,e)}),n.reduce(function(e,t){return i[t]=!0,i},i)}},e.prototype.select=function(){this.inputBox.select()},e.prototype.focus=function(){this.inputBox.focus()},e.prototype.isGlobPattern=function(){return this.pattern.checked},e.prototype.setIsGlobPattern=function(e){this.pattern.checked=e,this.setInputWidth()},e.prototype.setInputWidth=function(){var e=this.width-this.pattern.width();this.inputBox.width=e},e.prototype.buildDomNode=function(){var e=this;this.domNode=document.createElement("div"),this.domNode.style.width=this.width+"px",m.$(this.domNode).addClass("monaco-findInput"),this.inputBox=new q.InputBox(this.domNode,this.contextViewProvider,{placeholder:this.placeholder||"",ariaLabel:this.ariaLabel||"",validationOptions:{validation:null,showMessage:!0}}),this.pattern=new F.Checkbox({actionClassName:"pattern",title:i.localize(15,null),isChecked:!1,onChange:function(t){e.onOptionChange(null),t||e.inputBox.focus(),e.setInputWidth(),e.isGlobPattern()?e.showGlobHelp():e.inputBox.hideMessage()}}),m.$(this.pattern.domNode).on("mouseover",function(){e.isGlobPattern()&&e.showGlobHelp()}),m.$(this.pattern.domNode).on(["mouseleave","mouseout"],function(){e.inputBox.hideMessage()}),this.setInputWidth();var t=document.createElement("div");t.className="controls",t.appendChild(this.pattern.domNode),this.domNode.appendChild(t)},e.prototype.showGlobHelp=function(){this.inputBox.showMessage({type:q.MessageType.INFO,formatContent:!0,content:i.localize(16,null)},!0)},e.OPTION_CHANGE="optionChange",e}(),de=function(e){function t(t,n,i,o,s,r,a,c,l,u,h,p,d){var f=this;e.call(this,X,t),this.eventService=n,this.editorService=i,this.progressService=o,this.messageService=s,this.storageService=r,this.contextViewService=a,this.instantiationService=c,this.configurationService=l,this.contextService=u,this.searchService=h,this.textFileService=p,this.viewletVisible=d.createKey("searchViewletVisible",!0),this.callOnModelChange=[],this.queryBuilder=this.instantiationService.createInstance(O.QueryBuilder),this.viewletSettings=this.getMemento(r,C.Scope.WORKSPACE),this.toUnbind.push(this.eventService.addListener(M.EventType.FILE_CHANGES,function(e){return f.onFilesChanged(e)})),this.toUnbind.push(this.eventService.addListener(P.EventType.UNTITLED_FILE_DELETED,function(e){return f.onUntitledFileDeleted(e)})),this.toUnbind.push(this.configurationService.onDidUpdateConfiguration(function(e){return f.onConfigurationUpdated(e.config)}).dispose)}return __extends(t,e),t.prototype.onConfigurationUpdated=function(e){this.updateGlobalPatternExclusions(e)},t.prototype.getResults=function(){return this.results},t.prototype.create=function(t){var o=this;e.prototype.create.call(this,t);var s,r=this.viewletSettings["query.filePatterns"]||"",a=this.viewletSettings["query.folderExclusions"]||"",c=this.viewletSettings["query.exclusionsUsePattern"],l=this.viewletSettings["query.includesUsePattern"],h=this.viewletSettings["query.folderIncludes"]||"",d=this.viewletSettings["query.contentPattern"]||"",v=this.viewletSettings["query.regex"]===!0,g=this.viewletSettings["query.wholeWords"]===!0,b=this.viewletSettings["query.caseSensitive"]===!0;this.domNode=t.div({"class":"search-viewlet"},function(e){s=e});var w=function(e){e.keyCode===Y.KeyCode.Enter?o.onQueryChanged(!0):e.keyCode===Y.KeyCode.Escape&&o.cancelSearch()},S=function(e){w(new f.StandardKeyboardEvent(e))};this.queryBox=s.div({"class":"query-box"},function(e){var t={label:i.localize(17,null),validation:function(e){if(0===e.length)return null;if(!o.findInput.getRegex())return null;var t;try{t=new RegExp(e)}catch(n){return{content:n.message}}return u.regExpLeadsToEndlessLoop(t)?{content:i.localize(18,null)}:void 0},placeholder:i.localize(19,null)};o.findInput=new y.FindInput(e.getHTMLElement(),o.contextViewService,t),o.findInput.onKeyUp(w),o.findInput.onKeyDown(function(e){e.keyCode===Y.KeyCode.DownArrow&&(p.EventHelper.stop(e),o.showsFileTypes()?o.toggleFileTypes(!0,!0):o.selectTreeIfNotSelected(e))}),o.findInput.onDidOptionChange(function(e){o.onQueryChanged(!0,e)}),o.findInput.setValue(d),o.findInput.setRegex(v),o.findInput.setCaseSensitive(b),o.findInput.setWholeWords(g)}).style({position:"relative"}).getHTMLElement(),this.queryDetails=s.div({"class":["query-details","separator"]},function(e){e.div({"class":"more",tabindex:0,role:"button",title:i.localize(20,null)}).on(p.EventType.CLICK,function(e){p.EventHelper.stop(e),o.toggleFileTypes(!0)}).on(p.EventType.KEY_UP,function(e){var t=new f.StandardKeyboardEvent(e);(t.equals(Y.CommonKeybindings.ENTER)||t.equals(Y.CommonKeybindings.SPACE))&&(p.EventHelper.stop(e),o.toggleFileTypes())}),e.div({"class":"file-types"},function(e){var t=i.localize(21,null);e.element("h4",{text:t}),o.inputPatternIncludes=new pe(e.getContainer(),o.contextViewService,{ariaLabel:i.localize(22,null)}),o.inputPatternIncludes.setIsGlobPattern(l),o.inputPatternIncludes.setValue(h),o.inputPatternIncludes.on(p.EventType.KEY_UP,S).on(p.EventType.KEY_DOWN,function(e){var t=new f.StandardKeyboardEvent(e);t.equals(Y.CommonKeybindings.UP_ARROW)?(p.EventHelper.stop(e),o.findInput.focus(),o.findInput.select()):t.equals(Y.CommonKeybindings.DOWN_ARROW)&&(p.EventHelper.stop(e),o.inputPatternExclusions.focus(),o.inputPatternExclusions.select())}).on(y.FindInput.OPTION_CHANGE,function(e){o.onQueryChanged(!1)})}),e.div({"class":"file-types"},function(e){var t=i.localize(23,null);e.element("h4",{text:t}),o.inputPatternExclusions=new pe(e.getContainer(),o.contextViewService,{ariaLabel:i.localize(24,null)}),o.inputPatternExclusions.setIsGlobPattern(c),o.inputPatternExclusions.setValue(a),o.inputPatternExclusions.on(p.EventType.KEY_UP,S).on(p.EventType.KEY_DOWN,function(e){var t=new f.StandardKeyboardEvent(e);t.equals(Y.CommonKeybindings.UP_ARROW)?(p.EventHelper.stop(e),o.inputPatternIncludes.focus(),o.inputPatternIncludes.select()):t.equals(Y.CommonKeybindings.DOWN_ARROW)&&(p.EventHelper.stop(e),o.selectTreeIfNotSelected(t))}).on(y.FindInput.OPTION_CHANGE,function(e){o.onQueryChanged(!1)})}),o.inputPatternGlobalExclusionsContainer=e.div({"class":"file-types global-exclude disabled"},function(e){var t=i.localize(25,null);e.element("h4",{text:t}),o.inputPatternGlobalExclusions=new q.InputBox(e.getContainer(),o.contextViewService,{actions:[o.instantiationService.createInstance(he)],ariaLabel:i.localize(26,null)}),o.inputPatternGlobalExclusions.inputElement.readOnly=!0,m.$(o.inputPatternGlobalExclusions.inputElement).attr("aria-readonly","true"),m.$(o.inputPatternGlobalExclusions.inputElement).addClass("disabled")}).hide()}).getHTMLElement(),this.messages=s.div({"class":"messages"}).hide().clone(),s.div({"class":"results"},function(e){o.results=e;var t=new Z,n=o.instantiationService.createInstance(re,o.getActionRunner());o.tree=new _.Tree(e.getHTMLElement(),{dataSource:t,renderer:n,sorter:new ee,filter:new ie,controller:new ne(o),accessibilityProvider:o.instantiationService.createInstance(te)},{ariaLabel:i.localize(27,null)}),o.toUnbind.push(function(){return n.dispose()}),o.toUnbind.push(o.tree.addListener("selection",function(e){var t,n=e.payload&&"keyboard"===e.payload.origin;t=n?o.tree.getFocus():e.selection[0];var i=e.payload&&e.payload.originalEvent,s=e.payload&&"mouse"===e.payload.origin&&i&&2===i.detail;s&&i.preventDefault();var r=i&&(i.ctrlKey||i.metaKey);o.onFocus(t,!n&&!s,r)}))}),this.actionRegistry={};var x=[new le(this),new ae(this),new ue(this),new ce(this)];return x.forEach(function(e){o.actionRegistry[e.id]=e}),""===r&&""===a&&""===h||this.toggleFileTypes(!0,!0,!0),this.updateGlobalPatternExclusions(this.configurationService.getConfiguration()),n.TPromise.as(null)},t.prototype.updateGlobalPatternExclusions=function(e){if(this.inputPatternGlobalExclusionsContainer){var t=O.getExcludes(e);if(t){var n=Object.getOwnPropertyNames(t).filter(function(e){return t[e]===!0||"string"==typeof t[e].when}).map(function(e){return t[e]===!0?e:i.localize(28,null,e,t[e].when)});if(n.length){var o=n.join(", ");this.inputPatternGlobalExclusions.value=o,this.inputPatternGlobalExclusions.inputElement.title=o,this.inputPatternGlobalExclusionsContainer.show()}else this.inputPatternGlobalExclusionsContainer.hide()}}},t.prototype.setVisible=function(t){var n;if(this.viewletVisible.set(t),t?(n=e.prototype.setVisible.call(this,t),this.tree.onVisible()):(this.tree.onHidden(),n=e.prototype.setVisible.call(this,t)),this.viewModel&&this.viewModel.toggleHighlights(t),t&&!this.editorService.getActiveEditorInput()){var i=this.tree.getFocus();i&&this.onFocus(i,!1,!1)}return n},t.prototype.focus=function(){e.prototype.focus.call(this);var t=this.getSelectionFromEditor();t&&this.findInput.setValue(t),this.findInput.focus(),this.findInput.select()},t.prototype.reLayout=function(){if(!this.isDisposed){this.findInput.setWidth(this.size.width-34),this.inputPatternExclusions.setWidth(this.size.width-42),this.inputPatternIncludes.setWidth(this.size.width-42),this.inputPatternGlobalExclusions.width=this.size.width-42-24;var e=p.getTotalHeight(this.queryBox),t=p.getTotalHeight(this.queryDetails),n=this.size.height-e-t;this.results.style({height:n+"px"}),this.tree.layout(n)}},t.prototype.layout=function(e){this.size=e,this.reLayout()},t.prototype.getControl=function(){return this.tree},t.prototype.clearSearchResults=function(){this.disposeModel(),this.showEmptyStage(),this.findInput.clear(),this.currentRequest&&(this.currentRequest.cancel(),this.currentRequest=null)},t.prototype.cancelSearch=function(){return this.currentRequest?(this.findInput.focus(),this.findInput.select(),this.currentRequest.cancel(),this.currentRequest=null,!0):!1},t.prototype.selectTreeIfNotSelected=function(e){if(this.tree.getInput()){this.tree.DOMFocus();var t=this.tree.getSelection();0===t.length&&this.tree.focusNext()}},t.prototype.getSelectionFromEditor=function(){if(!this.editorService.getActiveEditor())return null;var e=this.editorService.getActiveEditor().getControl();if(!e||!l.isFunction(e.getEditorType)||e.getEditorType()!==o.EditorType.ICodeEditor)return null;var t=e.getSelection();if(t&&!t.isEmpty()&&t.startLineNumber===t.endLineNumber){var n=e.getModel().getLineContent(t.startLineNumber);return n=n.substring(t.startColumn-1,t.endColumn-1)}return null},t.prototype.showsFileTypes=function(){return p.hasClass(this.queryDetails,"more")},t.prototype.toggleFileTypes=function(e,t,n){var i="more";t="undefined"==typeof t?!p.hasClass(this.queryDetails,i):Boolean(t),n=Boolean(n),t?(p.addClass(this.queryDetails,i),e&&(this.inputPatternIncludes.focus(),this.inputPatternIncludes.select())):(p.removeClass(this.queryDetails,i),e&&(this.findInput.focus(),this.findInput.select())),!n&&this.size&&this.layout(this.size)},t.prototype.searchInFolder=function(e){this.showsFileTypes()||this.toggleFileTypes(!0,!0);var t=this.contextService.toWorkspaceRelativePath(e);t&&(this.inputPatternIncludes.setIsGlobPattern(!1),this.inputPatternIncludes.setValue(t),this.findInput.focus())},t.prototype.onQueryChanged=function(e,n){var i=this.findInput.getRegex(),o=this.findInput.getWholeWords(),s=this.findInput.getCaseSensitive(),r=this.findInput.getValue(),a=this.inputPatternExclusions.getValue().trim(),c=this.inputPatternExclusions.isGlobPattern(),l=this.inputPatternIncludes.getValue().trim(),h=this.inputPatternIncludes.isGlobPattern();if(this.viewletSettings["query.contentPattern"]=r,this.viewletSettings["query.regex"]=i,this.viewletSettings["query.wholeWords"]=o,this.viewletSettings["query.caseSensitive"]=s,this.viewletSettings["query.folderExclusions"]=a,this.viewletSettings["query.exclusionsUsePattern"]=c,this.viewletSettings["query.folderIncludes"]=l,this.viewletSettings["query.includesUsePattern"]=h,e&&0!==r.length){if(i){var p=void 0;try{p=new RegExp(r)}catch(d){return}if(u.regExpLeadsToEndlessLoop(p))return}var f={pattern:r,isRegExp:i,isCaseSensitive:s,isWordMatch:o},v=this.inputPatternExclusions.getGlob(),m=this.inputPatternIncludes.getGlob(),g={folderResources:this.contextService.getWorkspace()?[this.contextService.getWorkspace().resource]:[],extraFileResources:this.textFileService.getWorkingFilesModel().getOutOfWorkspaceContextEntries().map(function(e){return e.resource}),excludePattern:v,includePattern:m,maxResults:t.MAX_TEXT_RESULTS};this.onQueryTriggered(this.queryBuilder.text(f,g),a,l),n||this.findInput.focus()}},t.prototype.onQueryTriggered=function(e,t,n){var o=this;this.currentRequest&&(this.currentRequest.cancel(),this.currentRequest=null);var s=this.telemetryService.timedPublicLog("searchResultsFirstRender"),c=this.telemetryService.timedPublicLog("searchResultsFinished"),l=100,u=this.progressService.show(l),h=0;this.loading=!0,this.findInput.clearMessage(),this.disposeModel(),this.showEmptyStage();var d=Object.create(null),f=function(e){if(o.viewModel){var t=o.viewModel.matches();t.forEach(function(n){if(!d[n.id()]){d[n.id()]=!0;var i=n.matches().length;10>i||e&&1===t.length&&50>i?o.tree.expand(n).done(null,r.onUnexpectedError):o.tree.collapse(n).done(null,r.onUnexpectedError)}})}},g=v.start(v.Topic.WORKBENCH,"Search"),y=!1,b=function(s){g.stop(),y=!0,s?(u.worked(l-h),setTimeout(function(){return u.done()},200)):u.done(),o.viewModel||(o.viewModel=o.instantiationService.createInstance(A.SearchResult,e.contentPattern),
s&&o.viewModel.append(s.results)),o.tree.refresh().then(function(){f(!0)}).done(void 0,r.onUnexpectedError);var d=!o.viewModel.isEmpty();if(o.loading=!1,o.telemetryService.publicLog("searchResultsShown",{count:o.viewModel.count(),fileCount:o.viewModel.fileCount()}),o.actionRegistry.refresh.enabled=!0,o.actionRegistry.selectOrRemove.enabled=d,o.actionRegistry.collapseAll.enabled=d,o.actionRegistry.clearSearchResults.enabled=d,s&&s.limitHit&&o.findInput.showMessage({content:i.localize(29,null),type:q.MessageType.WARNING}),d)o.viewModel.toggleHighlights(!0),a.status(i.localize(38,null,o.viewModel.count(),o.viewModel.fileCount()));else{var v=!!t,b=!!n,w=void 0;w=s?b&&v?i.localize(31,null,n,t):b?i.localize(32,null,n):v?i.localize(33,null,t):i.localize(34,null):i.localize(30,null),a.status(w),o.tree.onHidden(),o.results.hide();var _=o.messages.empty().show().asContainer().div({"class":"message",text:w});s?b||v?m.$(_).a({"class":["pointer","prominent"],tabindex:"0",text:i.localize(36,null)}).on(p.EventType.CLICK,function(e){p.EventHelper.stop(e,!1),o.inputPatternExclusions.setValue(""),o.inputPatternIncludes.setValue(""),o.onQueryChanged(!0)}):m.$(_).a({"class":["pointer","prominent"],tabindex:"0",text:i.localize(37,null)}).on(p.EventType.CLICK,function(e){p.EventHelper.stop(e,!1);var t=o.instantiationService.createInstance(I.OpenGlobalSettingsAction,I.OpenGlobalSettingsAction.ID,I.OpenGlobalSettingsAction.LABEL);t.run().done(function(){return t.dispose()},r.onUnexpectedError)}):m.$(_).a({"class":["pointer","prominent"],text:i.localize(35,null)}).on(p.EventType.CLICK,function(e){p.EventHelper.stop(e,!1),o.onQueryChanged(!0)})}c.stop()},w=function(e){r.isPromiseCanceledError(e)?b(null):(o.loading=!1,y=!0,u.done(),s.stop(),c.stop(),o.messageService.show(2,e))},_=0,S=0,x=0,E=[],C=function(t){t.total&&(_=t.total),t.worked&&(S=t.worked),t.resource&&(E.push(t),o.viewModel||(o.viewModel=o.instantiationService.createInstance(A.SearchResult,e.contentPattern),o.tree.setInput(o.viewModel).then(function(){f(!1),o.callOnModelChange.push(o.viewModel.addListener("changed",function(e){return o.tree.refresh(e,!0)}))}).done(null,r.onUnexpectedError)),o.viewModel.append([t]),s.stop())},P=setInterval(function(){if(y)return void window.clearInterval(P);var e=!0;if(_>0&&S>0){var t=Math.round(S/_*100);t>h&&(u.worked(t-h),h=t,e=!1)}e&&90>h&&(h++,u.worked(1)),x!==E.length&&(x=E.length,o.tree.refresh().then(function(){f(!1)}).done(null,r.onUnexpectedError),o.actionRegistry.collapseAll.enabled||(o.actionRegistry.collapseAll.enabled=!0))},200);this.currentRequest=this.searchService.search(e),this.currentRequest.then(b,w,C)},t.prototype.showEmptyStage=function(){this.actionRegistry.refresh.enabled=!1,this.actionRegistry.selectOrRemove.enabled=!1,this.actionRegistry.collapseAll.enabled=!1,this.actionRegistry.clearSearchResults.enabled=!1,this.messages.hide(),this.tree.setInput(this.instantiationService.createInstance(A.SearchResult,null)).done(null,r.onUnexpectedError),this.results.show(),this.tree.onVisible()},t.prototype.onFocus=function(e,t,i){return e instanceof A.Match?(this.telemetryService.publicLog("searchResultChosen"),this.editorService.openEditor({resource:e.parent().resource(),options:{preserveFocus:t,selection:e instanceof A.EmptyMatch?void 0:e.range()}},i)):n.TPromise.as(!0)},t.prototype.onUntitledFileDeleted=function(e){if(this.viewModel)for(var t=this.viewModel.matches(),n=0,i=t.length;i>n;n++)e.resource.toString()===t[n].resource().toString()&&this.viewModel.remove(t[n])},t.prototype.onFilesChanged=function(e){if(this.viewModel)for(var t=this.viewModel.matches(),n=0,i=t.length;i>n;n++)e.contains(t[n].resource(),M.FileChangeType.DELETED)&&this.viewModel.remove(t[n])},t.prototype.getActions=function(){return[this.actionRegistry.refresh,this.actionRegistry.collapseAll,this.actionRegistry.clearSearchResults]},t.prototype.dispose=function(){this.isDisposed=!0,this.tree&&this.tree.dispose(),this.disposeModel(),e.prototype.dispose.call(this)},t.prototype.disposeModel=function(){this.viewModel&&(this.viewModel.dispose(),this.viewModel=null),s.cAll(this.callOnModelChange)},t.MAX_TEXT_RESULTS=2048,t=__decorate([__param(0,$.ITelemetryService),__param(1,H.IEventService),__param(2,D.IWorkbenchEditorService),__param(3,U.IProgressService),__param(4,B.IMessageService),__param(5,z.IStorageService),__param(6,W.IContextViewService),__param(7,V.IInstantiationService),__param(8,G.IConfigurationService),__param(9,j.IWorkspaceContextService),__param(10,K.ISearchService),__param(11,R.ITextFileService),__param(12,Q.IKeybindingService)],t)}(T.Viewlet);t.SearchViewlet=de});
//# sourceMappingURL=https://ticino.blob.core.windows.net/sourcemaps/def9e32467ad6e4f48787d38caf190acbfee5880/vs\workbench\parts\search\browser\searchViewlet.js.map
