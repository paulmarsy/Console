/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
"use strict";var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__decorate=this&&this.__decorate||function(e,t,r,n){if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)return Reflect.decorate(e,t,r,n);switch(arguments.length){case 2:return e.reduceRight(function(e,t){return t&&t(e)||e},t);case 3:return e.reduceRight(function(e,n){return void(n&&n(t,r))},void 0);case 4:return e.reduceRight(function(e,n){return n&&n(t,r,e)||e},n)}},__param=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}};define("vs/workbench/parts/output/common/outputWorker",["require","exports","vs/platform/markers/common/markers","vs/editor/common/services/resourceService","vs/editor/common/modes/abstractModeWorker","vs/base/common/strings","vs/base/common/arrays","vs/base/common/paths","vs/editor/common/core/range","vs/platform/workspace/common/workspace"],function(e,t,r,n,o,c,a,s,i,u){var p=function(e){function t(r,n,o,c,a){e.call(this,r,n,o,c),this._contextService=a;var s=this._contextService.getWorkspace();this.patterns=s?t.createPatterns(s):[]}return __extends(t,e),Object.defineProperty(t.prototype,"contextService",{get:function(){return this._contextService},enumerable:!0,configurable:!0}),t.prototype.computeLinks=function(r){var n=this;return e.prototype.computeLinks.call(this,r).then(function(e){if(!n.patterns.length)return e;for(var o=n.resourceService.get(r),c=1,a=o.getLineCount();a>=c;c++)e.push.apply(e,t.detectLinks(o.getLineContent(c),c,n.patterns,n._contextService));return e})},t.createPatterns=function(e){var t=[],r=a.distinct([s.normalize(e.resource.fsPath,!0),s.normalize(e.resource.fsPath,!1)]);return r.forEach(function(e){t.push(new RegExp(c.escapeRegExpCharacters(e)+"(\\S*) on line ((\\d+)(, column (\\d+))?)","gi")),t.push(new RegExp(c.escapeRegExpCharacters(e)+"(\\S*):line ((\\d+)(, column (\\d+))?)","gi")),t.push(new RegExp(c.escapeRegExpCharacters(e)+"([^\\s\\(\\)]*)(\\s?\\((\\d+)(,(\\d+))?)\\)","gi")),t.push(new RegExp(c.escapeRegExpCharacters(e)+"([^:\\s\\(\\)<>'\"\\[\\]]*)(:(\\d+))?(:(\\d+))?","gi"))}),t},t.detectLinks=function(e,t,r,n){var o=[];return r.forEach(function(r){r.lastIndex=0;for(var a,s=0;null!==(a=r.exec(e));){var u=c.replaceAll(c.rtrim(a[1],"."),"\\","/"),p=void 0;try{p=n.toResource(u).toString()}catch(f){continue}if(a[3]){var m=a[3];if(a[5]){var h=a[5];p=c.format("{0}#{1},{2}",p,m,h)}else p=c.format("{0}#{1}",p,m)}var d=c.rtrim(a[0],"."),v=e.indexOf(d,s);s+=v+d.length;var g={startColumn:v+1,startLineNumber:t,endColumn:v+1+d.length,endLineNumber:t};if(o.some(function(e){return i.Range.areIntersectingOrTouching(e.range,g)}))return;o.push({range:g,url:p})}}),o},t=__decorate([__param(2,n.IResourceService),__param(3,r.IMarkerService),__param(4,u.IWorkspaceContextService)],t)}(o.AbstractModeWorker);t.OutputWorker=p});