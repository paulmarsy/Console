/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
"use strict";define("vs/languages/html/common/htmlScanner",["require","exports","vs/languages/html/common/htmlTokenTypes"],function(e,n,t){function o(e){switch(e){case t.DELIM_START:case t.DELIM_END:case t.DELIM_ASSIGN:return!0}return!1}function l(e){switch(e){case t.DELIM_START:case t.DELIM_END:case t.DELIM_ASSIGN:case t.ATTRIB_NAME:case t.ATTRIB_VALUE:return!0}return t.isTag(e)}function r(e,n){var t=n.column-1,r=n.lineNumber,a=e.getLineTokens(r),i=e.getLineContent(r),s=a.findIndexOfOffset(t),c=a.getTokenCount(),u=a.getTokenType(s),g=a.getTokenStartIndex(s),d=a.getTokenEndIndex(s,i.length);return""!==u&&!o(u)||g!==t||(s--,s>=0?(u=a.getTokenType(s),g=a.getTokenStartIndex(s),d=a.getTokenEndIndex(s,i.length)):(u="",g=d=0)),{getTokenType:function(){return u},isAtTokenEnd:function(){return t===d},isAtTokenStart:function(){return t===g},getTokenContent:function(){return i.substring(g,d)},isOpenBrace:function(){return d>g&&"<"===i.charAt(g)},getTokenPosition:function(){return{lineNumber:r,column:g+1}},getTokenRange:function(){return{startLineNumber:r,startColumn:g+1,endLineNumber:r,endColumn:d+1}},getModel:function(){return e},scanBack:function(){if(0>=r)return!1;s--;do{for(;s>=0;){if(u=a.getTokenType(s),g=a.getTokenStartIndex(s),d=a.getTokenEndIndex(s,i.length),l(u))return!0;s--}r--,r>0&&(a=e.getLineTokens(r),i=e.getLineContent(r),c=a.getTokenCount(),s=c-1)}while(r>0);return a=null,u=i="",g=d=c=0,!1},scanForward:function(){if(r>e.getLineCount())return!1;s++;do{for(;c>s;){if(u=a.getTokenType(s),g=a.getTokenStartIndex(s),d=a.getTokenEndIndex(s,i.length),l(u))return!0;s++}r++,s=0,r<=e.getLineCount()&&(a=e.getLineTokens(r),i=e.getLineContent(r),c=a.getTokenCount())}while(r<=e.getLineCount());return u=i="",g=d=c=0,!1}}}n.getScanner=r}),define("vs/nls!vs/languages/html/common/htmlTags",["vs/nls","vs/nls!vs/languages/html/common/htmlWorker"],function(e,n){return e.create("vs/languages/html/common/htmlTags",n)}),/*---------------------------------------------------------------------------------------------
 *  Copyright © 2015 W3C® (MIT, ERCIM, Keio, Beihang). This document includes material copied
 *  from or derived from HTML 5.1 W3C Working Draft (http://www.w3.org/TR/2015/WD-html51-20151008/.)"
 *--------------------------------------------------------------------------------------------*/
define("vs/languages/html/common/htmlTags",["require","exports","vs/base/common/strings","vs/nls!vs/languages/html/common/htmlTags"],function(e,n,t,o){function l(){var e=["aria-activedescendant","aria-atomic:b","aria-autocomplete:autocomplete","aria-busy:b","aria-checked:tristate","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current:current","aria-describedat","aria-describedby","aria-disabled:b","aria-dropeffect:dropeffect","aria-errormessage","aria-expanded:u","aria-flowto","aria-grabbed:u","aria-haspopup:b","aria-hidden:b","aria-invalid:invalid","aria-kbdshortcuts","aria-label","aria-labelledby","aria-level","aria-live:live","aria-modal:b","aria-multiline:b","aria-multiselectable:b","aria-orientation:orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed:tristate","aria-readonly:b","aria-relevant:relevant","aria-required:b","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected:u","aria-setsize","aria-sort:sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","accesskey","class","contenteditable:b","contextmenu","dir:d","draggable:b","dropzone","hidden:v","id","itemid","itemprop","itemref","itemscope:v","itemtype","lang","role:roles","spellcheck:b","style","tabindex","title","translate:y"],o=["onabort","onblur","oncanplay","oncanplaythrough","onchange","onclick","oncontextmenu","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformchange","onforminput","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onmousedown","onmousemove","onmouseout","onmouseover","onmouseup","onmousewheel","onpause","onplay","onplaying","onprogress","onratechange","onreset","onresize","onreadystatechange","onscroll","onseeked","onseeking","onselect","onshow","onstalled","onsubmit","onsuspend","ontimeupdate","onvolumechange","onwaiting"],l={b:["true","false"],u:["true","false","undefined"],o:["on","off"],y:["yes","no"],w:["soft","hard"],d:["ltr","rtl","auto"],m:["GET","POST","dialog"],fm:["GET","POST"],s:["row","col","rowgroup","colgroup"],t:["hidden","text","search","tel","url","email","password","datetime","date","month","week","time","datetime-local","number","range","color","checkbox","radio","file","submit","image","reset","button"],im:["verbatim","latin","latin-name","latin-prose","full-width-latin","kana","kana-name","katakana","numeric","tel","email","url"],bt:["button","submit","reset","menu"],lt:["1","a","A","i","I"],mt:["context","toolbar"],mit:["command","checkbox","radio"],et:["application/x-www-form-urlencoded","multipart/form-data","text/plain"],tk:["subtitles","captions","descriptions","chapters","metadata"],pl:["none","metadata","auto"],sh:["circle","default","poly","rect"],xo:["anonymous","use-credentials"],sb:["allow-forms","allow-modals","allow-pointer-lock","allow-popups","allow-popups-to-escape-sandbox","allow-same-origin","allow-scripts","allow-top-navigation"],tristate:["true","false","mixed","undefined"],autocomplete:["inline","list","both","none"],current:["page","step","location","date","time","true","false"],dropeffect:["copy","move","link","execute","popup","none"],invalid:["grammar","false","spelling","true"],live:["off","polite","assertive"],orientation:["vertical","horizontal","undefined"],relevant:["additions","removals","text","all","additions text"],sort:["ascending","descending","none","other"],roles:["alert","alertdialog","button","checkbox","dialog","gridcell","link","log","marquee","menuitem","menuitemcheckbox","menuitemradio","option","progressbar","radio","scrollbar","searchbox","slider","spinbutton","status","switch","tab","tabpanel","textbox","timer","tooltip","treeitem","combobox","grid","listbox","menu","menubar","radiogroup","tablist","tree","treegrid","application","article","cell","columnheader","definition","directory","document","feed","figure","group","heading","img","list","listitem","math","none","note","presentation","region","row","rowgroup","rowheader","separator","table","term","text","toolbar","banner","complementary","contentinfo","form","main","navigation","region","search"]};return{collectTags:function(e){for(var t in n.HTML_TAGS)e(t,n.HTML_TAGS[t].label)},collectAttributes:function(t,l){if(e.forEach(function(e){var n=e.split(":");l(n[0],n[1])}),o.forEach(function(e){l(e,"event")}),t){var r=n.HTML_TAGS[t].attributes;r&&r.forEach(function(e){var n=e.split(":");l(n[0],n[1])})}},collectValues:function(o,r,a){var i=r+":",s=function(e){e.forEach(function(e){if(e.length>i.length&&t.startsWith(e,i)){var n=e.substr(i.length);if("v"===n)a(r);else{var o=l[n];o&&o.forEach(a)}}})},c=n.HTML_TAGS[o].attributes;c&&s(c),s(e)}}}function r(){var e={input:["ng-model","ng-required","ng-minlength","ng-maxlength","ng-pattern","ng-trim"],select:["ng-model"],textarea:["ng-model","ng-required","ng-minlength","ng-maxlength","ng-pattern","ng-trim"]},n=["ng-app","ng-bind","ng-bindhtml","ng-bindtemplate","ng-blur","ng-change","ng-checked","ng-class","ng-classeven","ng-classodd","ng-click","ng-cloak","ng-controller","ng-copy","ng-csp","ng-cut","ng-dblclick","ng-disabled","ng-focus","ng-form","ng-hide","ng-href","ng-if","ng-include","ng-init","ng-jq","ng-keydown","ng-keypress","ng-keyup","ng-list","ng-modelOptions","ng-mousedown","ng-mouseenter","ng-mouseleave","ng-mousemove","ng-mouseover","ng-mouseup","ng-nonbindable","ng-open","ng-options","ng-paste","ng-pluralize","ng-readonly","ng-repeat","ng-selected","ng-show","ng-src","ng-srcset","ng-style","ng-submit","ng-switch","ng-transclude","ng-value"];return{collectTags:function(e){},collectAttributes:function(t,o){if(t){var l=e[t];l&&l.forEach(function(e){o(e,null),o("data-"+e,null)})}n.forEach(function(e){o(e,null),o("data-"+e,null)})},collectValues:function(e,n,t){}}}var a=function(){function e(e,n){void 0===n&&(n=[]),this.label=e,this.attributes=n}return e}();n.HTMLTagSpecification=a,n.HTML_TAGS={html:new a(o.localize(0,null),["manifest"]),head:new a(o.localize(1,null)),title:new a(o.localize(2,null)),base:new a(o.localize(3,null),["href","target"]),link:new a(o.localize(4,null),["href","crossorigin:xo","rel","media","hreflang","type","sizes"]),meta:new a(o.localize(5,null),["name","http-equiv","content","charset"]),style:new a(o.localize(6,null),["media","nonce","type","scoped:v"]),body:new a(o.localize(7,null),["onafterprint","onbeforeprint","onbeforeunload","onhashchange","onlanguagechange","onmessage","onoffline","ononline","onpagehide","onpageshow","onpopstate","onstorage","onunload"]),article:new a(o.localize(8,null)),section:new a(o.localize(9,null)),nav:new a(o.localize(10,null)),aside:new a(o.localize(11,null)),h1:new a(o.localize(12,null)),h2:new a(o.localize(13,null)),h3:new a(o.localize(14,null)),h4:new a(o.localize(15,null)),h5:new a(o.localize(16,null)),h6:new a(o.localize(17,null)),header:new a(o.localize(18,null)),footer:new a(o.localize(19,null)),address:new a(o.localize(20,null)),p:new a(o.localize(21,null)),hr:new a(o.localize(22,null)),pre:new a(o.localize(23,null)),blockquote:new a(o.localize(24,null),["cite"]),ol:new a(o.localize(25,null),["reversed:v","start","type:lt"]),ul:new a(o.localize(26,null)),li:new a(o.localize(27,null),["value"]),dl:new a(o.localize(28,null)),dt:new a(o.localize(29,null)),dd:new a(o.localize(30,null)),figure:new a(o.localize(31,null)),figcaption:new a(o.localize(32,null)),main:new a(o.localize(33,null)),div:new a(o.localize(34,null)),a:new a(o.localize(35,null),["href","target","download","ping","rel","hreflang","type"]),em:new a(o.localize(36,null)),strong:new a(o.localize(37,null)),small:new a(o.localize(38,null)),s:new a(o.localize(39,null)),cite:new a(o.localize(40,null)),q:new a(o.localize(41,null),["cite"]),dfn:new a(o.localize(42,null)),abbr:new a(o.localize(43,null)),ruby:new a(o.localize(44,null)),rb:new a(o.localize(45,null)),rt:new a(o.localize(46,null)),rp:new a(o.localize(47,null)),time:new a(o.localize(48,null),["datetime"]),code:new a(o.localize(49,null)),"var":new a(o.localize(50,null)),samp:new a(o.localize(51,null)),kbd:new a(o.localize(52,null)),sub:new a(o.localize(53,null)),sup:new a(o.localize(54,null)),i:new a(o.localize(55,null)),b:new a(o.localize(56,null)),u:new a(o.localize(57,null)),mark:new a(o.localize(58,null)),bdi:new a(o.localize(59,null)),bdo:new a(o.localize(60,null)),span:new a(o.localize(61,null)),br:new a(o.localize(62,null)),wbr:new a(o.localize(63,null)),ins:new a(o.localize(64,null)),del:new a(o.localize(65,null),["cite","datetime"]),picture:new a(o.localize(66,null)),img:new a(o.localize(67,null),["alt","src","srcset","crossorigin:xo","usemap","ismap:v","width","height"]),iframe:new a(o.localize(68,null),["src","srcdoc","name","sandbox:sb","seamless:v","allowfullscreen:v","width","height"]),embed:new a(o.localize(69,null),["src","type","width","height"]),object:new a(o.localize(70,null),["data","type","typemustmatch:v","name","usemap","form","width","height"]),param:new a(o.localize(71,null),["name","value"]),video:new a(o.localize(72,null),["src","crossorigin:xo","poster","preload:pl","autoplay:v","mediagroup","loop:v","muted:v","controls:v","width","height"]),audio:new a(o.localize(73,null),["src","crossorigin:xo","preload:pl","autoplay:v","mediagroup","loop:v","muted:v","controls:v"]),source:new a(o.localize(74,null),["src","type"]),track:new a(o.localize(75,null),["default:v","kind:tk","label","src","srclang"]),map:new a(o.localize(76,null),["name"]),area:new a(o.localize(77,null),["alt","coords","shape:sh","href","target","download","ping","rel","hreflang","type"]),table:new a(o.localize(78,null),["sortable:v","border"]),caption:new a(o.localize(79,null)),colgroup:new a(o.localize(80,null),["span"]),col:new a(o.localize(81,null),["span"]),tbody:new a(o.localize(82,null)),thead:new a(o.localize(83,null)),tfoot:new a(o.localize(84,null)),tr:new a(o.localize(85,null)),td:new a(o.localize(86,null),["colspan","rowspan","headers"]),th:new a(o.localize(87,null),["colspan","rowspan","headers","scope:s","sorted","abbr"]),form:new a(o.localize(88,null),["accept-charset","action","autocomplete:o","enctype:et","method:m","name","novalidate:v","target"]),label:new a(o.localize(89,null),["form","for"]),input:new a(o.localize(90,null),["accept","alt","autocomplete:o","autofocus:v","checked:v","dirname","disabled:v","form","formaction","formenctype:et","formmethod:fm","formnovalidate:v","formtarget","height","inputmode:im","list","max","maxlength","min","minlength","multiple:v","name","pattern","placeholder","readonly:v","required:v","size","src","step","type:t","value","width"]),button:new a(o.localize(91,null),["autofocus:v","disabled:v","form","formaction","formenctype:et","formmethod:fm","formnovalidate:v","formtarget","name","type:bt","value"]),select:new a(o.localize(92,null),["autocomplete:o","autofocus:v","disabled:v","form","multiple:v","name","required:v","size"]),datalist:new a(o.localize(93,null)),optgroup:new a(o.localize(94,null),["disabled:v","label"]),option:new a(o.localize(95,null),["disabled:v","label","selected:v","value"]),textarea:new a(o.localize(96,null),["autocomplete:o","autofocus:v","cols","dirname","disabled:v","form","inputmode:im","maxlength","minlength","name","placeholder","readonly:v","required:v","rows","wrap:w"]),output:new a(o.localize(97,null),["for","form","name"]),progress:new a(o.localize(98,null),["value","max"]),meter:new a(o.localize(99,null),["value","min","max","low","high","optimum"]),fieldset:new a(o.localize(100,null),["disabled:v","form","name"]),legend:new a(o.localize(101,null)),details:new a(o.localize(102,null),["open:v"]),summary:new a(o.localize(103,null)),dialog:new a(o.localize(104,null)),script:new a(o.localize(105,null),["src","type","charset","async:v","defer:v","crossorigin:xo","nonce"]),noscript:new a(o.localize(106,null)),template:new a(o.localize(107,null)),canvas:new a(o.localize(108,null),["width","height"])},n.getHTML5TagProvider=l,n.getAngularTagProvider=r});var __extends=this&&this.__extends||function(e,n){function t(){this.constructor=e}for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o]);e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)},__decorate=this&&this.__decorate||function(e,n,t,o){if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)return Reflect.decorate(e,n,t,o);switch(arguments.length){case 2:return e.reduceRight(function(e,n){return n&&n(e)||e},n);case 3:return e.reduceRight(function(e,o){return void(o&&o(n,t))},void 0);case 4:return e.reduceRight(function(e,o){return o&&o(n,t,e)||e},o)}},__param=this&&this.__param||function(e,n){return function(t,o){n(t,o,e)}};define("vs/languages/html/common/htmlWorker",["require","exports","vs/base/common/winjs.base","vs/editor/common/modes/abstractModeWorker","vs/languages/lib/common/beautify-html","vs/languages/html/common/htmlTags","vs/base/common/network","vs/base/common/strings","vs/editor/common/core/range","vs/editor/common/core/position","vs/platform/workspace/common/workspace","vs/platform/markers/common/markers","vs/editor/common/services/resourceService","vs/languages/html/common/htmlScanner","vs/languages/html/common/htmlTokenTypes","vs/languages/html/common/htmlEmptyTagsShared"],function(e,n,t,o,l,r,a,i,s,c,u,g,d,p,m,f){function h(e){return/^\s*$/.test(e)}var T;!function(e){e[e.LOOKING_FOR_HREF_OR_SRC=1]="LOOKING_FOR_HREF_OR_SRC",e[e.AFTER_HREF_OR_SRC=2]="AFTER_HREF_OR_SRC"}(T||(T={}));var v=function(e){function n(n,t,o,l,a){e.call(this,n,t,o,l),this._contextService=a,this._tagProviders=[],this._tagProviders.push(r.getHTML5TagProvider()),this.addCustomTagProviders(this._tagProviders)}return __extends(n,e),n.prototype.addCustomTagProviders=function(e){e.push(r.getAngularTagProvider())},n.prototype.format=function(e,n,t){var o=this;return this._delegateToModeAtPosition(e,c.Position.startPosition(n),function(l,r){return l&&r.getMode().formattingSupport?r.getMode().formattingSupport.formatRange(r.getAssociatedResource(),n,t):o.formatHTML(e,n,t)})},n.prototype.formatHTML=function(e,n,o){var r=this.resourceService.get(e),a=n?r.getValueInRange(n):r.getValue(),i=l.html_beautify(a,{indent_size:o.insertSpaces?o.tabSize:1,indent_char:o.insertSpaces?" ":"	",wrap_line_length:120});return t.TPromise.as([{range:n,text:i}])},n.prototype._delegateToModeAtPosition=function(e,n,t){var o=this.resourceService.get(e);if(!o)return null;var l=o.getEmbeddedAtPosition(n);if(!l)return t(!1,o);var r=l.getMode();return t(r.getId()!==this._getMode().getId(),l)},n.prototype._delegateToAllModes=function(e,n){var t=this.resourceService.get(e);return t?n(t.getAllEmbedded()):null},n.prototype.computeInfo=function(e,n){return this._delegateToModeAtPosition(e,n,function(e,t){return e&&t.getMode().extraInfoSupport?t.getMode().extraInfoSupport.computeInfo(t.getAssociatedResource(),n):void 0})},n.prototype.findReferences=function(e,n,t){return this._delegateToModeAtPosition(e,n,function(e,o){return e&&o.getMode().referenceSupport?o.getMode().referenceSupport.findReferences(o.getAssociatedResource(),n,t):void 0})},n.prototype.getRangesToPosition=function(e,n){return this._delegateToModeAtPosition(e,n,function(e,t){return e&&t.getMode().logicalSelectionSupport?t.getMode().logicalSelectionSupport.getRangesToPosition(t.getAssociatedResource(),n):void 0})},n.prototype.findDeclaration=function(e,n){return this._delegateToModeAtPosition(e,n,function(e,t){return e&&t.getMode().declarationSupport?t.getMode().declarationSupport.findDeclaration(t.getAssociatedResource(),n):void 0})},n.prototype.findColorDeclarations=function(e){return this._delegateToAllModes(e,function(e){var n=[];return n=e.filter(function(e){return"function"==typeof e.getMode().findColorDeclarations}).map(function(e){return e.getMode().findColorDeclarations(e.getAssociatedResource())}),t.TPromise.join(n).then(function(e){var n=[];return e.forEach(function(e){return n=n.concat(e)}),n})})},n.prototype.getParameterHints=function(e,n){return this._delegateToModeAtPosition(e,n,function(e,t){return e&&t.getMode().parameterHintsSupport?t.getMode().parameterHintsSupport.getParameterHints(t.getAssociatedResource(),n):void 0})},n.prototype.findMatchingOpenTag=function(e){for(var n={},t=!1;e.scanBack();)if(m.isTag(e.getTokenType())&&!t){var o=e.getTokenContent();if(e.scanBack(),e.getTokenType()===m.DELIM_END)n[o]=(n[o]||0)+1;else if(!f.isEmptyElement(o)){if(!n[o])return o;n[o]--}}else e.getTokenType()===m.DELIM_START&&(t="/>"===e.getTokenContent());return null},n.prototype.collectTagSuggestions=function(e,n,t){var o=this,l=e.getModel(),r=l.getLineContent(n.lineNumber).substr(n.column-1),a=h(r)||i.startsWith(r,"<")?">":"",s=function(r,i){var s=e.getTokenPosition(),c=o.findMatchingOpenTag(e);if(c){var u={label:"/"+c,codeSnippet:"/"+c+a,overwriteBefore:i,type:"property"};if(t.suggestions.push(u),r){var g=e.getTokenPosition();if(s.lineNumber!==g.lineNumber){var d=l.getLineContent(g.lineNumber).substring(0,g.column-1),p=l.getLineContent(s.lineNumber).substring(0,s.column-1);h(d)&&h(p)&&(u.overwriteBefore=n.column-1,u.codeSnippet=d+"</"+c+a)}}return!0}return!1};if(e.getTokenType()===m.DELIM_END){var c=s(!0,t.currentWord.length+1);c||this._tagProviders.forEach(function(e){e.collectTags(function(e,n){t.suggestions.push({label:"/"+e,overwriteBefore:t.currentWord.length+1,codeSnippet:"/"+e+a,type:"property",documentationLabel:n})})})}else s(!1,t.currentWord.length),this._tagProviders.forEach(function(e){e.collectTags(function(e,n){t.suggestions.push({label:e,codeSnippet:e,type:"property",documentationLabel:n})})})},n.prototype.collectContentSuggestions=function(e){},n.prototype.collectAttributeSuggestions=function(e,n){var t=null;do{if(m.isTag(e.getTokenType())){t=e.getTokenContent();break}if(e.getTokenType()===m.DELIM_START)break}while(e.scanBack());this._tagProviders.forEach(function(e){e.collectAttributes(t,function(e,t){var o=e;"v"!==t&&(o+='="{{}}"'),n.suggestions.push({label:e,codeSnippet:o,type:"handler"===t?"function":"value"})})})},n.prototype.collectAttributeValueSuggestions=function(e,n){for(var t=e.getTokenType()===m.DELIM_ASSIGN,o=null,l=null;e.scanBack();)if(e.getTokenType()===m.ATTRIB_NAME){o=e.getTokenContent();break}for(;e.scanBack();){if(m.isTag(e.getTokenType())){l=e.getTokenContent();break}if(e.getTokenType()===m.DELIM_START)return}this._tagProviders.forEach(function(e){e.collectValues(l,o,function(e){n.suggestions.push({label:e,codeSnippet:t?'"'+e+'"':e,type:"unit"})})})},n.prototype.suggest=function(e,n,t){var o=this;return this._delegateToModeAtPosition(e,n,function(l,r){return l&&r.getMode().suggestSupport?r.getMode().suggestSupport.suggest(r.getAssociatedResource(),n,t):o.suggestHTML(e,n)})},n.prototype.suggestHTML=function(n,t){return e.prototype.suggest.call(this,n,t)},n.prototype.doSuggest=function(e,n){var o=this.resourceService.get(e),l=o.getWordUntilPosition(n).word,r={currentWord:l,suggestions:[]},a=p.getScanner(o,n);switch(a.getTokenType()){case m.DELIM_START:case m.DELIM_END:a.isOpenBrace()?this.collectTagSuggestions(a,n,r):this.collectContentSuggestions(r);break;case m.ATTRIB_NAME:this.collectAttributeSuggestions(a,r);break;case m.ATTRIB_VALUE:this.collectAttributeValueSuggestions(a,r);break;case m.DELIM_ASSIGN:a.isAtTokenEnd()&&this.collectAttributeValueSuggestions(a,r);break;case"":if(h(a.getTokenContent())&&a.scanBack())switch(a.getTokenType()){case m.ATTRIB_VALUE:case m.ATTRIB_NAME:this.collectAttributeSuggestions(a,r);break;case m.DELIM_ASSIGN:this.collectAttributeValueSuggestions(a,r);break;case m.DELIM_START:case m.DELIM_END:a.isOpenBrace()?this.collectTagSuggestions(a,n,r):this.collectContentSuggestions(r);break;default:m.isTag(a.getTokenType())&&this.collectAttributeSuggestions(a,r)}else this.collectContentSuggestions(r);break;default:m.isTag(a.getTokenType())&&(a.scanBack(),this.collectTagSuggestions(a,n,r))}return t.Promise.as(r)},n.prototype.findMatchingBracket=function(e,n){if(f.isEmptyElement(e))return null;var t=0;if(n.scanBack(),n.getTokenType()===m.DELIM_END)for(var o=!1;n.scanBack();)if(m.isTag(n.getTokenType())&&n.getTokenContent()===e&&!o){var l=n.getTokenRange();if(n.scanBack(),n.getTokenType()===m.DELIM_START){if(0===t)return l;t--}else t++}else n.getTokenType()===m.DELIM_START&&(o="/>"===n.getTokenContent());else for(var r=!1;n.scanForward();)if(m.isTag(n.getTokenType())&&n.getTokenContent()===e)if(r){if(t--,0>=t)return n.getTokenRange()}else if(n.scanForward(),n.getTokenType()===m.DELIM_START&&"/>"===n.getTokenContent()){if(0>=t)return null}else t++;else n.getTokenType()===m.DELIM_START?r=!1:n.getTokenType()===m.DELIM_END&&(r=!0);return null},n.prototype.findOccurrences=function(e,n,t){var o=this;return void 0===t&&(t=!1),this._delegateToModeAtPosition(e,n,function(l,r){return l&&r.getMode().occurrencesSupport?r.getMode().occurrencesSupport.findOccurrences(r.getAssociatedResource(),n,t):o.findOccurrencesHTML(e,n,t)})},n.prototype.findOccurrencesHTML=function(e,n,o){var l=this.resourceService.get(e),r=l.getWordAtPosition(n),a=r?r.word:"",i=[],s=p.getScanner(l,n);if(m.isTag(s.getTokenType())){var c=s.getTokenContent();i.push({range:s.getTokenRange()});var u=this.findMatchingBracket(c,s);u&&i.push({range:u})}else for(var g=l.getAllWordsWithRange(),d=Math.min(1e3,g.length),f=0;d>f;f++)g[f].text===a&&i.push({range:g[f].range});return t.TPromise.as(i)},n._stripQuotes=function(e){return e.replace(/^'([^']+)'$/,function(e,n){return n}).replace(/^"([^"]+)"$/,function(e,n){return n})},n._getWorkspaceUrl=function(e,t,o){var l=a.URL.fromUri(e),r=a.URL.fromUri(t);if(o=n._stripQuotes(o),/^\s*javascript\:/i.test(o)||/^\s*\#/i.test(o))return null;if(/^\s*https?:\/\//i.test(o)||/^\s*file:\/\//i.test(o))return o.replace(/^\s*/g,"");if(/^\s*\/\//i.test(o)){var s=l.getScheme(),c="http";return s===a.schemas.https&&(c=a.schemas.https),c+":"+o.replace(/^\s*/g,"")}try{var u=l.combine(o).toString()}catch(g){return null}if(r&&l.startsWith(r)){var d=r.toString(),p=i.commonPrefixLength(d,u);return i.endsWith(d,"/")&&(p=u.lastIndexOf("/",p)+1),d+u.substr(p)}return u},n.prototype.createLink=function(e,t,o,l,r,a){var i=n._getWorkspaceUrl(e,t,o);return i?{range:{startLineNumber:l,startColumn:r,endLineNumber:l,endColumn:a},url:i}:null},n.prototype._computeHTMLLinks=function(e){var n,t,o,l,r,i,s,c,u,g,d=e.getLineCount(),p=[],f=T.LOOKING_FOR_HREF_OR_SRC,h=e.getAssociatedResource(),v=null,w=this._contextService.getWorkspace();if(w){var b=String(w.resource);v="/"===b.charAt(b.length-1)?new a.URL(b):new a.URL(b+"/")}for(n=1;d>=n;n++)for(t=e.getLineContent(n),o=t.length,l=e.getLineTokens(n),s=0,i=l.getTokenCount();i>s;s++)switch(r=l.getTokenType(s)){case m.DELIM_ASSIGN:case"":break;case m.ATTRIB_NAME:f===T.LOOKING_FOR_HREF_OR_SRC&&(c=l.getTokenEndIndex(s,o),u=t.substring(l.getTokenStartIndex(s),c).toLowerCase(),("src"===u||"href"===u)&&(f=T.AFTER_HREF_OR_SRC));break;case m.ATTRIB_VALUE:f===T.AFTER_HREF_OR_SRC&&(c=l.getTokenEndIndex(s,o),u=t.substring(l.getTokenStartIndex(s),c),g=this.createLink(h,v,u,n,l.getTokenStartIndex(s)+2,c),g&&p.push(g),f=T.LOOKING_FOR_HREF_OR_SRC);default:m.isTag(r)?f=T.LOOKING_FOR_HREF_OR_SRC:f===T.AFTER_HREF_OR_SRC&&(f=T.LOOKING_FOR_HREF_OR_SRC)}return p},n.prototype.computeLinks=function(n){var t=this;return e.prototype.computeLinks.call(this,n).then(function(e){var o,l,r,a,i,c,u,g=t.resourceService.get(n),d=t._computeHTMLLinks(g),p=[];for(o=0,r=0,l=e.length,a=d.length;l>o&&a>r;)i=e[o],c=d[r],s.Range.areIntersectingOrTouching(i.range,c.range)?o++:(u=s.Range.compareRangesUsingStarts(i.range,c.range),0>u?(p.push(i),o++):(p.push(c),r++));for(;l>o;o++)p.push(e[o]);for(;a>r;r++)p.push(d[r]);return p})},n=__decorate([__param(2,d.IResourceService),__param(3,g.IMarkerService),__param(4,u.IWorkspaceContextService)],n)}(o.AbstractModeWorker);n.HTMLWorker=v});