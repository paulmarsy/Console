"use strict";var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)};define("vs/languages/html/common/html",["require","exports","vs/editor/common/modes/modesRegistry","vs/editor/common/modes/supports","vs/base/common/arrays","vs/platform/platform","vs/platform/instantiation/common/descriptors","vs/base/common/winjs.base","vs/editor/common/modes","vs/editor/common/modes/abstractMode","vs/editor/common/modes/abstractState","vs/platform/thread/common/threadService","vs/editor/common/modes/supports/onEnter"],function(t,e,r,n,o,i,a,s,u,c,p,d,l){!function(t){t[t.Content=0]="Content",t[t.OpeningStartTag=1]="OpeningStartTag",t[t.OpeningEndTag=2]="OpeningEndTag",t[t.WithinDoctype=3]="WithinDoctype",t[t.WithinTag=4]="WithinTag",t[t.WithinComment=5]="WithinComment",t[t.WithinEmbeddedContent=6]="WithinEmbeddedContent",t[t.AttributeName=7]="AttributeName",t[t.AttributeValue=8]="AttributeValue"}(e.States||(e.States={}));var h=e.States,m=["script","style"],g=function(t){function e(e,r,n,o,i,a,s){t.call(this,e),this.kind=r,this.lastTagName=n,this.lastAttributeName=o,this.embeddedContentType=i,this.attributeValueQuote=a,this.attributeValue=s}return __extends(e,t),e.escapeTagName=function(t){return"tag.html.tag-"+t.replace(/[:_]/g,"-")},e.prototype.makeClone=function(){return new e(this.getMode(),this.kind,this.lastTagName,this.lastAttributeName,this.embeddedContentType,this.attributeValueQuote,this.attributeValue)},e.prototype.equals=function(r){return r instanceof e?t.prototype.equals.call(this,r)&&this.kind===r.kind&&this.lastTagName===r.lastTagName&&this.lastAttributeName===r.lastAttributeName&&this.embeddedContentType===r.embeddedContentType&&this.attributeValueQuote===r.attributeValueQuote&&this.attributeValue===r.attributeValue:!1},e.prototype.nextName=function(t){return t.advanceIfRegExp(/^[_:\w][_:\w-.\d]*/).toLowerCase()},e.prototype.tokenize=function(t){switch(this.kind){case h.WithinComment:if(t.advanceUntilString2("-->",!1))return{type:"comment.html.content"};if(t.advanceIfString2("-->"))return this.kind=h.Content,{type:"comment.html",bracket:u.Bracket.Close};break;case h.WithinDoctype:if(t.advanceUntilString2(">",!1))return{type:"metatag.content.html"};if(t.advanceIfString2(">"))return this.kind=h.Content,{type:"metatag.html",bracket:u.Bracket.Close};break;case h.Content:if(t.advanceIfCharCode2("<".charCodeAt(0))){if(!t.eos()&&"!"===t.peek()){if(t.advanceIfString2("!--"))return this.kind=h.WithinComment,{type:"comment.html",bracket:u.Bracket.Open};if(t.advanceIfStringCaseInsensitive2("!DOCTYPE"))return this.kind=h.WithinDoctype,{type:"metatag.html",bracket:u.Bracket.Open}}return t.advanceIfCharCode2("/".charCodeAt(0))?(this.kind=h.OpeningEndTag,{type:"delimiter.end.html",bracket:u.Bracket.Open}):(this.kind=h.OpeningStartTag,{type:"delimiter.start.html",bracket:u.Bracket.Open})}break;case h.OpeningEndTag:var r=this.nextName(t);return r.length>0?{type:e.escapeTagName(r)}:t.advanceIfString2(">")?(this.kind=h.Content,{type:"delimiter.end.html",bracket:u.Bracket.Close}):(t.advanceUntilString2(">",!1),{type:""});case h.OpeningStartTag:if(this.lastTagName=this.nextName(t),this.lastTagName.length>0)return this.lastAttributeName=null,("script"===this.lastTagName||"style"===this.lastTagName)&&(this.lastAttributeName=null,this.embeddedContentType=null),this.kind=h.WithinTag,{type:e.escapeTagName(this.lastTagName)};break;case h.WithinTag:if(t.skipWhitespace2()||t.eos())return{type:""};var n=this.nextName(t);return n.length>0?(this.lastAttributeName=n,this.kind=h.AttributeName,{type:"attribute.name.html"}):t.advanceIfString2("/>")?(this.kind=h.Content,{type:"delimiter.start.html",bracket:u.Bracket.Close}):t.advanceIfCharCode2(">".charCodeAt(0))?-1!==m.indexOf(this.lastTagName)?(this.kind=h.WithinEmbeddedContent,{type:"delimiter.start.html",bracket:u.Bracket.Close}):(this.kind=h.Content,{type:"delimiter.start.html",bracket:u.Bracket.Close}):(t.next2(),{type:""});case h.AttributeName:return t.skipWhitespace2()||t.eos()?{type:""}:t.advanceIfCharCode2("=".charCodeAt(0))?(this.kind=h.AttributeValue,{type:"delimiter.assign.html"}):(this.kind=h.WithinTag,this.tokenize(t));case h.AttributeValue:if(t.eos())return{type:""};if(t.skipWhitespace2())return'"'===this.attributeValueQuote||"'"===this.attributeValueQuote?{type:"attribute.value.html"}:{type:""};if('"'!==this.attributeValueQuote&&"'"!==this.attributeValueQuote){var o=t.peek();return"'"===o||'"'===o?(this.attributeValueQuote=o,this.attributeValue=o,t.next2(),{type:"attribute.value.html"}):(this.kind=h.WithinTag,this.tokenize(t))}if(this.attributeValue!==this.attributeValueQuote||"script"!==this.lastTagName&&"style"!==this.lastTagName||"type"!==this.lastAttributeName){if(t.advanceIfCharCode2(this.attributeValueQuote.charCodeAt(0)))this.kind=h.WithinTag,this.attributeValue="",this.attributeValueQuote="";else{var i=t.next();this.attributeValue+=i}return{type:"attribute.value.html"}}if(this.attributeValue=t.advanceUntilString(this.attributeValueQuote,!0),this.attributeValue.length>0)return this.embeddedContentType=this.unquote(this.attributeValue),this.kind=h.WithinTag,this.attributeValue="",this.attributeValueQuote="",{type:"attribute.value.html"}}return t.next2(),this.kind=h.Content,{type:""}},e.prototype.unquote=function(t){var e=0,r=t.length;return'"'===t[0]&&e++,'"'===t[r-1]&&r--,t.substring(e,r)},e}(p.AbstractState);e.State=g;var f=function(t){function e(e,r,o,i){var s=this;void 0===i&&(i=a.AsyncDescriptor.create("vs/languages/html/common/htmlWorker","HTMLWorker")),t.call(this,e,r,o,i),this.modeService=e.modeService,this.tokenizationSupport=new n.TokenizationSupport(this,this,!0,!0),this.electricCharacterSupport=new n.BracketElectricCharacterSupport(this,{brackets:[],regexBrackets:[{tokenType:"tag.html.tag-$1",open:/<(?!(?:area|base|basefont|br|col|command|embed|frame|hr|img|input|link|meta|param|source|track|wbr))(\w[\w\d]*)([^\/>]*(?!\/)>)[^<]*$/i,closeComplete:"</$1>",close:/<\/(\w[\w\d]*)\s*>$/i}],caseInsensitive:!0,embeddedElectricCharacters:["*","}","]",")"]}),this.formattingSupport=this,this.extraInfoSupport=this,this.referenceSupport=new n.ReferenceSupport(this,{tokens:["invalid"],findReferences:function(t,e,r){return s.findReferences(t,e,r)}}),this.logicalSelectionSupport=this,this.parameterHintsSupport=new n.ParameterHintsSupport(this,{triggerCharacters:["(",","],excludeTokens:["*"],getParameterHints:function(t,e){return s.getParameterHints(t,e)}}),this.suggestSupport=new n.SuggestSupport(this,{triggerCharacters:[".",":","<",'"',"=","/"],excludeTokens:["comment"],suggest:function(t,e){return s.suggest(t,e)}}),this.onEnterSupport=new l.OnEnterSupport(this.getId(),{brackets:[{open:"<!--",close:"-->"}]})}return __extends(e,t),e.prototype.asyncCtor=function(){var t=this;return s.Promise.join([this.modeService.getOrCreateMode("text/javascript"),this.modeService.getOrCreateMode("text/css")]).then(function(e){var r=t._getAutoClosingPairs(e);t.characterPairSupport=new n.CharacterPairSupport(t,{autoClosingPairs:r.slice(0),surroundingPairs:[{open:'"',close:'"'},{open:"'",close:"'"}]})})},e.prototype._getAutoClosingPairs=function(t){var e=this,r={'"':'"',"'":"'"};t.forEach(function(t){return e._collectAutoClosingPairs(r,t)});var n,o=[];for(n in r)o.push({open:n,close:r[n]});return o},e.prototype._collectAutoClosingPairs=function(t,e){if(e&&e.characterPairSupport){var r=e.characterPairSupport.getAutoClosingPairs();if(null!==r)for(var n=0;n<r.length;n++)t[r[n].open]=r[n].close}},e.prototype.getInitialState=function(){return new g(this,h.Content,"","","","","")},e.prototype.enterNestedMode=function(t){return t instanceof g&&t.kind===h.WithinEmbeddedContent},e.prototype.getNestedMode=function(t){var e=null,r=t,n=null;if(null!==r.embeddedContentType)b.isRegisteredMode(r.embeddedContentType)&&(e=this.modeService.getMode(r.embeddedContentType),e||(n=this.modeService.getOrCreateMode(r.embeddedContentType)));else{var o=null;o="script"===r.lastTagName?"text/javascript":"style"===r.lastTagName?"text/css":"text/plain",e=this.modeService.getMode(o)}return null===e&&(e=this.modeService.getMode("text/plain")),{mode:e,missingModePromise:n}},e.prototype.getLeavingNestedModeData=function(t,e){var r=e.lastTagName,n=new RegExp("<\\/"+r+"\\s*>","i"),o=n.exec(t);return null!==o?{nestedModeBuffer:t.substring(0,o.index),bufferAfterNestedMode:t.substring(o.index),stateAfterNestedMode:new g(this,h.Content,"","","","","")}:null},e.prototype.getWordDefinition=function(){return e.WORD_DEFINITION},e.prototype.getCommentsConfiguration=function(){return{blockCommentStartToken:"<!--",blockCommentEndToken:"-->"}},e.prototype._worker=function(e){return t.prototype._worker.call(this,e)},e.prototype.formatDocument=function(t,e){return this._worker(function(r){return r.format(t,null,e)})},e.prototype.formatRange=function(t,e,r){return this._worker(function(n){return n.format(t,e,r)})},e.prototype.computeInfo=function(t,e){return this._delegateToModeAtPosition(t,e,function(t,r){return t&&r.getMode().extraInfoSupport?r.getMode().extraInfoSupport.computeInfo(r.getAssociatedResource(),e):void 0})},e.prototype.findReferences=function(t,e,r){return this._delegateToModeAtPosition(t,e,function(t,n){return t&&n.getMode().referenceSupport?n.getMode().referenceSupport.findReferences(n.getAssociatedResource(),e,r):void 0})},e.prototype.getRangesToPosition=function(t,e){return this._delegateToModeAtPosition(t,e,function(t,r){return t&&r.getMode().logicalSelectionSupport?r.getMode().logicalSelectionSupport.getRangesToPosition(r.getAssociatedResource(),e):void 0})},e.prototype.findDeclaration=function(t,e){return this._delegateToModeAtPosition(t,e,function(t,r){return t&&r.getMode().declarationSupport?r.getMode().declarationSupport.findDeclaration(r.getAssociatedResource(),e):void 0})},e.prototype.findOccurrences=function(t,e,r){var n=this;return void 0===r&&(r=!1),this._delegateToModeAtPosition(t,e,function(o,i){return o&&i.getMode().occurrencesSupport?i.getMode().occurrencesSupport.findOccurrences(i.getAssociatedResource(),e,r):n._worker(function(n){return n.findOccurrences(t,e,r)})})},e.prototype.suggest=function(t,e){var r=this;return this._delegateToModeAtPosition(t,e,function(n,o){return n&&o.getMode().suggestSupport?o.getMode().suggestSupport.suggest(o.getAssociatedResource(),e):r._worker(function(r){return r.suggest(t,e)})})},e.prototype.findColorDeclarations=function(t){return this._delegateToAllModes(t,function(t){var e=[];return e=t.filter(function(t){return"function"==typeof t.getMode().findColorDeclarations}).map(function(t){return t.getMode().findColorDeclarations(t.getAssociatedResource())}),s.TPromise.join(e).then(function(t){var e=[];return t.forEach(function(t){return e=e.concat(t)}),e})})},e.prototype.getParameterHints=function(t,e){return this._delegateToModeAtPosition(t,e,function(t,r){return t&&r.getMode().parameterHintsSupport?r.getMode().parameterHintsSupport.getParameterHints(r.getAssociatedResource(),e):void 0})},e.WORD_DEFINITION=c.createWordRegExp("#-?%"),e.$formatDocument=d.OneWorkerAttr(e,e.prototype.formatDocument),e.$formatRange=d.OneWorkerAttr(e,e.prototype.formatRange),e.$computeInfo=d.OneWorkerAttr(e,e.prototype.computeInfo),e.$findReferences=d.OneWorkerAttr(e,e.prototype.findReferences),e.$getRangesToPosition=d.OneWorkerAttr(e,e.prototype.getRangesToPosition),e.$findDeclaration=d.OneWorkerAttr(e,e.prototype.findDeclaration),e.$findOccurrences=d.OneWorkerAttr(e,e.prototype.findOccurrences),e.$suggest=d.OneWorkerAttr(e,e.prototype.suggest),e.$findColorDeclarations=d.OneWorkerAttr(e,e.prototype.findColorDeclarations),e.$getParameterHints=d.OneWorkerAttr(e,e.prototype.getParameterHints),e}(c.AbstractMode);e.HTMLMode=f;var b=i.Registry.as(r.Extensions.EditorModes)});