"use strict";define("vs/languages/typescript/common/participants/filenameSuggestions",["require","exports","vs/base/common/uri","vs/base/common/strings","vs/base/common/paths","vs/base/common/collections","vs/base/common/winjs.base","vs/languages/typescript/common/lib/typescriptServices","vs/languages/typescript/common/project/projectService"],function(e,t,r,n,i,o,s,a,u){var c=function(){function e(){}return e.prototype.makeModulePath=function(e,t,r){return e?this._toRequirePath(t,r):this._toReferencesPath(t,r)},e.prototype._toRequirePath=function(e,t){var r,o=i.dirname(t);return r=i.join(i.relative(o,i.dirname(e)),i.basename(e)),n.startsWith(r,"..")||(r="./"+r),r=n.rtrim(r,".ts"),r=n.rtrim(r,".js")},e.prototype._toReferencesPath=function(e,t){var r=i.dirname(t);return i.join(i.relative(r,i.dirname(e)),i.basename(e))},e}();t.PathMaker=c;var f=function(){function e(e){this._resourceServices=e.resourceService}return e.prototype.suggest=function(e,t,i){if(!(i instanceof u.ProjectService))return s.TPromise.as(null);var a=i.getProject(e),f=a.languageService.getSourceFile(e.toString()),l=this._findCurrentWord(e,t,f);if(!l)return s.TPromise.as(null);var g=new c,m=/^['"]/.test(l.wordUntilPosition)?l.wordUntilPosition[0]:'"',p={currentWord:l.wordUntilPosition,suggestions:[]},d=Object.create(null);return i.scriptsNames().forEach(function(t){if(!(l.external&&n.endsWith(t,".d.ts")||t===e.toString()||d[t]||"file"!==r["default"].parse(t).scheme)){var i=g.makeModulePath(l.external,t,e.toString());d[t]={label:n.format("{0}{1}{0}",m,i),codeSnippet:n.rtrim(n.format("{0}{1}{0}",m,i),l.wordAfterPosition),documentationLabel:r["default"].parse(t).fsPath,type:"reference"}}}),p.suggestions=o.values(d),s.TPromise.as(p)},e.prototype._findCurrentWord=function(t,r,n){var i=this._resourceServices.get(t),o=i.getOffsetFromPosition(r),s=a.findTokenOnLeftOfPosition(n,o),u=i.getLineContent(r.lineNumber),c=e._TrippleSlashReference.exec(u);if(c){var f=i.getOffsetFromPosition({lineNumber:r.lineNumber,column:1});return{wordUntilPosition:c[2].substring(0,o-(f+c[1].length)),wordAfterPosition:c[2].substring(o-(f+c[1].length)),external:!1}}if(l.isTokenPath(s,8,160))return{wordUntilPosition:a.getTextOfNode(s).substr(0,o-s.getStart()),wordAfterPosition:a.getTextOfNode(s).substr(o-s.getStart()),external:!0};if(l.isTokenPath(s,8,156,160)){var g=l.parent(s,2);if("require"===a.getTextOfNode(g.expression)||"define"===a.getTextOfNode(g.expression))return{wordUntilPosition:a.getTextOfNode(s).substr(0,o-s.getStart()),wordAfterPosition:a.getTextOfNode(s).substr(o-s.getStart()),external:!0}}},e._TrippleSlashReference=/^(\/\/\/\s*<reference\s+path=)([^\s>]+)/i,e}();t.FilenameSuggestions=f;var l;!function(e){function t(e,t){for(;t-->0&&e;)e=e.parent;return e}function r(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(;t.length>0&&e;){var n=t.shift();if(n!==e.kind)return!1;e=e.parent}return!0}e.parent=t,e.isTokenPath=r}(l||(l={}))});